function parseCrew() {
    const crewData = document.getElementById('crewList').value;
    const crewMembers = [];
    
    const lines = crewData.split('\n');
    for (let i = 0; i < lines.length - 2; i++) {
        const gradeLine = lines[i].trim();
        const nameLine = lines[i + 1].trim();
        const staffNumLine = lines[i + 2].trim();
        
        // Check for the pattern: Grade (PUR/FG1/GR1/GR2/CSA) -> Name -> Staff Number (S******)
        if (
            (gradeLine === 'PUR' || gradeLine === 'FG1' || gradeLine === 'GR1' || 
             gradeLine === 'GR2' || gradeLine === 'CSA') &&
            nameLine.length > 0 &&
            staffNumLine.startsWith('S')
        ) {
            crewMembers.push({
                grade: gradeLine,
                name: nameLine,
                id: staffNumLine
            });
            i += 2; // Skip the next two lines since we've processed them
        }
    }

    const selects = document.querySelectorAll('.crew-select');
    selects.forEach(select => {
        select.innerHTML = '<option value="">Select Crew</option>';
        crewMembers.forEach(crew => {
            // Don't add CSA to position selection dropdowns
            if (crew.grade !== 'CSA') {
                select.innerHTML += `<option value="${crew.id}">${crew.grade} ${crew.name} (${crew.id})</option>`;
            }
        });
    });

    const parsedCrewDiv = document.getElementById('parsedCrew');
    parsedCrewDiv.style.display = 'block';
    parsedCrewDiv.innerHTML = '<h4>Parsed Crew Members:</h4>' + 
        crewMembers.map(crew => `${crew.grade} ${crew.name} (${crew.id})`).join('<br>');

    // Store CSA info for email generation
    window.csaMember = crewMembers.find(crew => crew.grade === 'CSA');
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cabin Crew Briefing Tool</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
            background: #f0f2f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        h3 {
            margin-bottom: 15px;
            color: #2196F3;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        button {
            background: #2196F3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }

        button:hover {
            background: #1976D2;
        }

        .version-tag {
            font-size: 12px;
            color: #666;
            margin-left: 10px;
        }

        .position-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        .position-section {
            margin-top: 20px;
        }

        .position-section-title {
            font-weight: bold;
            margin-bottom: 10px;
            grid-column: 1 / -1;
            background: #f5f5f5;
            padding: 5px;
            border-radius: 4px;
        }

        .parsed-crew-container {
            margin-top: 15px;
            padding: 10px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: none;
        }

        .email-preview {
            white-space: pre-wrap;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            display: none;
        }

        .upgrade-prices-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .sector-input {
            margin-bottom: 15px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        #copyButton {
            display: none;
            background: #4CAF50;
        }

        #copyButton:hover {
            background: #45a049;
        }

        @media (max-width: 768px) {
            .position-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .upgrade-prices-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .position-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cabin Crew Briefing Tool</h1>
        
        <div class="section">
            <h3>Flight Details</h3>
            <div class="input-group">
                <label>Flight Number:</label>
                <input type="text" id="flightNumber" placeholder="e.g. EK123/124">
            </div>
            <div class="input-group">
                <label>Aircraft Type:</label>
                <select id="aircraftType" onchange="updatePositionSlots()">
                    <option value="">Select Aircraft Type</option>
                    <option value="B777">Boeing 777</option>
                    <option value="A380">Airbus 380</option>
                </select>
            </div>
            <div class="input-group">
                <label>Route:</label>
                <input type="text" id="route" placeholder="e.g. DXB-LHR-DXB">
            </div>
            <div class="input-group">
                <label>Flight Date:</label>
                <input type="date" id="flightDate">
            </div>
            <div class="input-group">
                <label>Your Name:</label>
                <input type="text" id="yourName" placeholder="Enter your name">
            </div>
        </div>

        <div class="section">
            <h3>Crew Data</h3>
            <div class="input-group">
                <label>Paste Crew List Here:</label>
                <textarea id="crewList" placeholder="Paste crew data here..."></textarea>
            </div>
            <button onclick="parseCrew()" class="parse-button">Parse Crew Data <span class="version-tag">v1.2</span></button>
            <div id="parsedCrew" class="parsed-crew-container"></div>
        </div>

        <div class="section">
            <h3>Position Allocation</h3>
            <div class="sector-input">
                <label>Sector Designator:</label>
                <input type="text" id="sectorDesignator" placeholder="e.g. DXB-LHR">
            </div>
            <div id="positionAllocation" class="position-grid">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <div class="section">
            <h3>Additional Information</h3>
            <div class="input-group">
                <label>IFR Target:</label>
                <input type="text" id="ifrTarget" placeholder="Enter IFR target">
            </div>
            <div class="input-group">
                <label>Upgrade Prices:</label>
                <div class="upgrade-prices-grid">
                    <div class="input-group">
                        <label>Legroom:</label>
                        <input type="text" id="legroom" placeholder="Enter legroom price">
                    </div>
                    <div class="input-group">
                        <label>Bulkhead:</label>
                        <input type="text" id="bulkhead" placeholder="Enter bulkhead price">
                    </div>
                    <div class="input-group">
                        <label>Y/J:</label>
                        <input type="text" id="yj" placeholder="Enter Y/J price">
                    </div>
                    <div class="input-group">
                        <label>J/F:</label>
                        <input type="text" id="jf" placeholder="Enter J/F price">
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>Generate Email</h3>
            <div class="button-group">
                <button onclick="generateEmail()">Generate Briefing Email</button>
                <button id="copyButton" onclick="copyEmail()" style="display: none;">Copy Email</button>
            </div>
            <div id="emailPreview" class="email-preview"></div>
        </div>
    </div>

    <script>
        const aircraftPositions = {
            'B777': {
                main: ['L1', 'R1', 'L2', 'R2', 'L3', 'R3', 'L4', 'R4', 'L5', 'R5'],
                assist: ['L1A', 'R1A', 'L2A', 'R2A', 'L5A']
            },
            'A380': {
                main_deck: ['ML1', 'MR1', 'ML2', 'MR2', 'ML3', 'MR3', 'ML4', 'MR4', 'ML5', 'MR5'],
                upper_deck: ['UL1', 'UR1', 'UL2', 'UR2', 'UL3', 'UR3'],
                assist: ['MR2A', 'MR3A', 'MR4A', 'ML4A', 'ML3A', 'UL1A', 'UR1A']
            }
        };

        function handlePositionSelect(event) {
            const selectedValue = event.target.value;
            updateAvailableCrew(selectedValue);
        }

        function updateAvailableCrew() {
            const selects = document.querySelectorAll('.crew-select');
            const assignedCrewIds = Array.from(selects)
                .map(select => select.value)
                .filter(value => value !== "");

            selects.forEach(select => {
                const currentValue = select.value;
                const originalOptions = window.allCrewMembers || [];
                
                select.innerHTML = '<option value="">Select Crew</option>';
                
                originalOptions.forEach(crew => {
                    if (!assignedCrewIds.includes(crew.id) || crew.id === currentValue) {
                        select.innerHTML += `<option value="${crew.id}" ${crew.id === currentValue ? 'selected' : ''}>
                            ${crew.grade} ${crew.name} (${crew.id})
                        </option>`;
                    }
                });
            });
        }

        function updatePositionSlots() {
            const aircraftType = document.getElementById('aircraftType').value;
            const container = document.getElementById('positionAllocation');
            container.innerHTML = '';

            if (!aircraftType) return;

            if (aircraftType === 'B777') {
                container.innerHTML += '<div class="position-section-title">Main Positions</div>';
                aircraftPositions.B777.main.forEach(pos => {
                    container.innerHTML += createPositionSelect(pos);
                });

                container.innerHTML += '<div class="position-section-title">Assist Positions</div>';
                aircraftPositions.B777.assist.forEach(pos => {
                    container.innerHTML += createPositionSelect(pos);
                });
            } else if (aircraftType === 'A380') {
                container.innerHTML += '<div class="position-section-title">Main Deck</div>';
                aircraftPositions.A380.main_deck.forEach(pos => {
                    container.innerHTML += createPositionSelect(pos);
                });

                container.innerHTML += '<div class="position-section-title">Upper Deck</div>';
                aircraftPositions.A380.upper_deck.forEach(pos => {
                    container.innerHTML += createPositionSelect(pos);
                });

                container.innerHTML += '<div class="position-section-title">Assist Positions</div>';
                aircraftPositions.A380.assist.forEach(pos => {
                    container.innerHTML += createPositionSelect(pos);
                });
            }
        }

        function createPositionSelect(position) {
            return `
                <div class="position-group">
                    <label>${position}:</label>
                    <select id="pos${position}" class="crew-select" onchange="handlePositionSelect(event)">
                        <option value="">Select Crew</option>
                    </select>
                </div>
            `;
        }

        function parseCrew() {
            const crewData = document.getElementById('crewList').value;
            const crewMembers = [];
            
            const lines = crewData.split('\n');
            for (let i = 0; i < lines.length - 2; i++) {
                const gradeLine = lines[i].trim();
                const nameLine = lines[i + 1].trim();
                const staffNumLine = lines[i + 2].trim();
                
                if (
                    (gradeLine === 'PUR' || gradeLine === 'FG1' || gradeLine === 'GR1' || 
                     gradeLine === 'GR2' || gradeLine === 'CSV') &&
                    nameLine.length > 0 &&
                    staffNumLine.startsWith('S')
                ) {
                    crewMembers.push({
                        grade: gradeLine,
                        name: nameLine,
                        id: staffNumLine
                    });
                    i += 2;
                }
            }

            window.allCrewMembers = crewMembers;

            const selects = document.querySelectorAll('.crew-select');
            selects.forEach(select => {
                select.innerHTML = '<option value="">Select Crew</option>';
                crewMembers.forEach(crew => {
                    select.innerHTML += `<option value="${crew.id}">${crew.grade} ${crew.name} (${crew.id})</option>`;
                });
            });

            const parsedCrewDiv = document.getElementById('parsedCrew');
            parsedCrewDiv.style.display = 'block';
            parsedCrewDiv.innerHTML = '<h4>Parsed Crew Members:</h4>' + 
                crewMembers.map(crew => `${crew.grade} ${crew.name} (${crew.id})`).join('<br>');

            window.csvMembers = crewMembers.filter(crew => crew.grade === 'CSV');
        }

        function getCSVNamesFormatted() {
            if (!window.csvMembers || window.csvMembers.length === 0) return '';
            
            const firstNames = window.csvMembers.map(csv => csv.name.split(' ')[0]);
            
            if (firstNames.length === 1) return firstNames[0];
            if (firstNames.length === 2) return `${firstNames[0]} and ${firstNames[1]}`;
            return `${firstNames.slice(0, -1).join(', ')} and ${firstNames[firstNames.length - 1]}`;
        }

        function generateEmail() {
            const aircraftType = document.getElementById('aircraftType').value;
            const flightNumber = document.getElementById('flightNumber').value;
            const route = document.getElementById('route').value;
            const flightDate = document.getElementById('flightDate').value;
            const yourName = document.getElementById('yourName').value;
            const sectorDesignator = document.getElementById('sectorDesignator').value;
            const ifrTarget = document.getElementById('ifrTarget').value;
            
            let emailContent = `Flight Details:
Aircraft: ${aircraftType}
Flight: ${flightNumber}
Route: ${route}
Date: ${flightDate}

Hello ladies and gents,

My name is ${yourName}, I am from Romania and it is my pleasure to be your purser on this flight.`;

            const csvNames = getCSVNamesFormatted();
            if (csvNames) {
                emailContent += `\nTogether with senior${window.csvMembers.length > 1 ? 's' : ''} ${csvNames}, we will support you, guide you and work alongside you at all times.`;
            }

            emailContent += `\nI want you to feel comfortable approaching us in any regards, be it professional or personal.
The flight deck crew are part of the team and it is important for you to know and use their names. It's a GCAA requirement, as well as a sign of respect for our colleagues.

My goal is to empower you to use your skills, knowledge and individual personalities to create a successful flight, keeping in mind the following expectations:
- We are brand ambassadors, wear the uniform with pride, be professional at all times as everyone is watching us.
- Please refresh your knowledge on SSQs for your respective cabins, ACIs, Flight Instructions and Flight Brief.
- There is specific information regarding our trip, please check destination information page in your crew pulse app and familiarise yourself with the requirements for this flight.
- Be thorough, ensure all safety and security standards are followed.
- Take ownership for your respective role and be a team player.
- Be considerate and kind with our customers and each other.

We are always improving the way we do things so keeping up-to-date is vital.

Inflight retail:

Ensure the inflight retail commencement is announced in Economy class and present in the cabin. Please ensure pre-order container is checked and follow up with me.`;

            if (ifrTarget) {
                emailContent += `\nIFR target for ${ifrTarget}`;
            }

            const legroom = document.getElementById('legroom').value;
            const bulkhead = document.getElementById('bulkhead').value;
            const yj = document.getElementById('yj').value;
            const jf = document.getElementById('jf').value;

            if (legroom || bulkhead || yj || jf) {
                emailContent += '\n\nUpgrade prices:';
                if (legroom) emailContent += `\nlegroom: ${legroom}`;
                if (bulkhead) emailContent += `\nbulkhead: ${bulkhead}`;
                if (yj) emailContent += `\nY/J: ${yj}`;
                if (jf) emailContent += `\nJ/F: ${jf}`;
            }

            emailContent += `\n\nI trust each one of you to bring your cheerful personality and kindness on our flight, to create special moments for our customers and deliver Emirates Excellence.

Positions have been assigned according to your experience and preferences. Positions are assigned for ${sectorDesignator}.\n`;

            if (aircraftType === 'B777') {
                [...aircraftPositions.B777.main, ...aircraftPositions.B777.assist].forEach(pos => {
                    const crewSelect = document.getElementById(`pos${pos}`);
                    if (crewSelect && crewSelect.value) {
                        const selectedOption = crewSelect.options[crewSelect.selectedIndex];
                        emailContent += `\n${pos}: ${selectedOption.text}`;
                    }
                });
            } else if (aircraftType === 'A380') {
                emailContent += '\nMain Deck:';
                aircraftPositions.A380.main_deck.forEach(pos => {
                    const crewSelect = document.getElementById(`pos${pos}`);
                    if (crewSelect && crewSelect.value) {
                        const selectedOption = crewSelect.options[crewSelect.selectedIndex];
                        emailContent += `\n${pos}: ${selectedOption.text}`;
                    }
                });

                emailContent += '\n\nUpper Deck:';
                aircraftPositions.A380.upper_deck.forEach(pos => {
                    const crewSelect = document.getElementById(`pos${pos}`);
                    if (crewSelect && crewSelect.value) {
                        const selectedOption = crewSelect.options[crewSelect.selectedIndex];
                        emailContent += `\n${pos}: ${selectedOption.text}`;
                    }
                });

                emailContent += '\n\nAssist Positions:';
                aircraftPositions.A380.assist.forEach(pos => {
                    const crewSelect = document.getElementById(`pos${pos}`);
                    if (crewSelect && crewSelect.value) {
                        const selectedOption = crewSelect.options[crewSelect.selectedIndex];
                        emailContent += `\n${pos}: ${selectedOption.text}`;
                    }
                });
            }

            emailContent += `\n\nSee you all soon,\n${yourName}`;

            const previewDiv = document.getElementById('emailPreview');
            previewDiv.style.display = 'block';
            previewDiv.textContent = emailContent;

            // Show the copy button
            document.getElementById('copyButton').style.display = 'inline-block';
        }

        function copyEmail() {
            const emailText = document.getElementById('emailPreview').textContent;
            navigator.clipboard.writeText(emailText).then(() => {
                const copyButton = document.getElementById('copyButton');
                const originalText = copyButton.textContent;
                copyButton.textContent = 'Copied!';
                setTimeout(() => {
                    copyButton.textContent = originalText;
                }, 2000);
            });
        }
    </script>
</body>
</html>

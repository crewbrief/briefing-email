<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cabin Crew Briefing Tool v1.4</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .section {
            margin-bottom: 20px;
        }
        textarea {
            width: 100%;
            height: 200px;
        }
        input, select {
            margin: 5px 0;
            padding: 5px;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
        }
        .reset-btn {
            background-color: #ff9999;
            border: none;
            color: white;
            border-radius: 4px;
        }
        #ifrTarget::placeholder {
            color: #999;
            font-style: italic;
        }
        .leaders-section {
            margin: 10px 0;
            padding: 10px;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cabin Crew Briefing Tool v1.4</h1>
        
        <button type="button" onclick="resetForm()" class="reset-btn">Reset Form</button>

        <div class="section">
            <h2>Flight Details</h2>
            <label>Flight Number:</label><br>
            <input type="text" id="flightNumber" value="EK" required><br>
            
            <label>Aircraft Type:</label><br>
            <select id="aircraftType" required>
                <option value="">Select Aircraft Type</option>
                <option value="B777">Boeing 777</option>
                <option value="A380">Airbus 380</option>
            </select><br>
            
            <label>Route:</label><br>
            <input type="text" id="route" required><br>
            
            <label>Flight Date:</label><br>
            <input type="date" id="flightDate" required><br>
            
            <label>Your Name:</label><br>
            <input type="text" id="yourName" oninput="capitalizeFirstLetter(this)" required><br>
        </div>

        <div class="section">
            <h2>Crew Data</h2>
            <textarea id="crewList" placeholder="Paste Crew List Here:"></textarea><br>
            <button onclick="parseCrewData()">Parse Crew Data</button>
        </div>

        <div class="leaders-section" id="leadersSection"></div>

        <div class="section">
            <h2>Position Allocation</h2>
            <div id="positionAllocation"></div>
            <label>Sector Designator:</label><br>
            <input type="text" id="sectorDesignator"><br>
        </div>

        <div class="section">
            <h2>Additional Information</h2>
            <label>IFR Target:</label><br>
            <input type="text" id="ifrTarget" placeholder="ENTER TARGET eg DXB-LHR 9999AED"><br>
            
            <label>Upgrade Prices:</label><br>
            <input type="text" id="upgradePrices"><br>
            
            <label>Legroom:</label><br>
            <input type="text" id="legroom"><br>
            
            <label>Bulkhead:</label><br>
            <input type="text" id="bulkhead"><br>
            
            <label>Y/J:</label><br>
            <input type="text" id="yj"><br>
            
            <label>J/F:</label><br>
            <input type="text" id="jf"><br>
        </div>

        <div class="section">
            <button onclick="generateEmail()">Generate Briefing Email</button>
            <button onclick="copyEmail()">Copy Email</button>
            <div id="emailOutput"></div>
        </div>
    </div>

    <script>
        let crewMembers = [];
        let unassignedCrew = [];
        let positions = {};
        
        function resetForm() {
            document.querySelectorAll('input:not([type="button"])').forEach(input => {
                if (input.id === 'flightNumber') {
                    input.value = 'EK';
                } else {
                    input.value = '';
                }
            });
            document.querySelectorAll('select').forEach(select => {
                select.selectedIndex = 0;
            });
            document.querySelectorAll('textarea').forEach(textarea => {
                textarea.value = '';
            });
            document.getElementById('leadersSection').innerHTML = '';
            document.getElementById('positionAllocation').innerHTML = '';
            document.getElementById('emailOutput').innerHTML = '';
            crewMembers = [];
            unassignedCrew = [];
            positions = {};
        }

        function capitalizeFirstLetter(input) {
            if (input.value.length > 0) {
                input.value = input.value.charAt(0).toUpperCase() + input.value.slice(1);
            }
        }

        function parseCrewData() {
            const crewList = document.getElementById('crewList').value;
            const lines = crewList.trim().split('\n');
            crewMembers = [];
            unassignedCrew = [];
            
            let purCount = 0;
            let csvCount = 0;
            const maxCSV = document.getElementById('aircraftType').value === 'A380' ? 3 : 2;

            for (let i = 0; i < lines.length; i += 3) {
                if (i + 2 < lines.length) {
                    const grade = lines[i].trim();
                    const name = lines[i + 1].trim();
                    const staffNumber = lines[i + 2].trim();

                    const crewMember = {
                        grade: grade,
                        name: name,
                        staffNumber: staffNumber
                    };

                    crewMembers.push(crewMember);
                    unassignedCrew.push(crewMember);

                    if (grade === 'PUR' && purCount < 1) {
                        purCount++;
                    }
                    if (grade === 'CSV' && csvCount < maxCSV) {
                        csvCount++;
                    }
                }
            }

            displayLeaders();
            createPositionAllocation();
        }

        function displayLeaders() {
            const leadersSection = document.getElementById('leadersSection');
            let leadersHtml = '<h3>Flight Leaders</h3>';
            
            // Display PUR
            const purLeader = crewMembers.find(cm => cm.grade === 'PUR');
            if (purLeader) {
                leadersHtml += `<p>PUR: ${purLeader.name}</p>`;
            }

            // Display CSVs
            const csvLeaders = crewMembers.filter(cm => cm.grade === 'CSV');
            csvLeaders.forEach((csv, index) => {
                leadersHtml += `<p>CSV${index + 1}: ${csv.name}</p>`;
            });

            leadersSection.innerHTML = leadersHtml;
        }

        function createPositionAllocation() {
            const container = document.getElementById('positionAllocation');
            const aircraftType = document.getElementById('aircraftType').value;
            
            let positions;
            if (aircraftType === 'A380') {
                positions = ['Door 1L', 'Door 1R', 'Door 2L', 'Door 2R', 'Door 3L', 'Door 3R', 'Door 4L', 'Door 4R', 'Door 5L', 'Door 5R'];
            } else if (aircraftType === 'B777') {
                positions = ['Door 1L', 'Door 1R', 'Door 2L', 'Door 2R', 'Door 3L', 'Door 3R', 'Door 4L', 'Door 4R'];
            }

            let html = '';
            positions.forEach(position => {
                html += `
                    <div>
                        <label>${position}:</label>
                        <select id="${position.replace(' ', '_')}" onchange="updatePositions()">
                            <option value="">Select Crew Member</option>
                            ${crewMembers.map(crew => `
                                <option value="${crew.name}">${crew.name} (${crew.grade})</option>
                            `).join('')}
                        </select>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function updatePositions() {
            positions = {};
            const selects = document.querySelectorAll('#positionAllocation select');
            selects.forEach(select => {
                if (select.value) {
                    positions[select.id.replace('_', ' ')] = select.value;
                }
            });
        }

        function generateEmail() {
            const flightNumber = document.getElementById('flightNumber').value;
            const aircraftType = document.getElementById('aircraftType').value;
            const route = document.getElementById('route').value;
            const flightDate = document.getElementById('flightDate').value;
            const sectorDesignator = document.getElementById('sectorDesignator').value;
            const ifrTarget = document.getElementById('ifrTarget').value;
            const upgradePrices = document.getElementById('upgradePrices').value;
            const legroom = document.getElementById('legroom').value;
            const bulkhead = document.getElementById('bulkhead').value;
            const yj = document.getElementById('yj').value;
            const jf = document.getElementById('jf').value;

            let email = `Flight: ${flightNumber}\n`;
            email += `Aircraft: ${aircraftType}\n`;
            email += `Route: ${route}\n`;
            email += `Date: ${flightDate}\n\n`;

            // Add Leaders Section
            email += "Flight Leaders:\n";
            const purLeader = crewMembers.find(cm => cm.grade === 'PUR');
            if (purLeader) {
                email += `PUR: ${purLeader.name}\n`;
            }
            const csvLeaders = crewMembers.filter(cm => cm.grade === 'CSV');
            csvLeaders.forEach((csv, index) => {
                email += `CSV${index + 1}: ${csv.name}\n`;
            });
            email += '\n';

            // Position Assignments
            email += "Position Assignments:\n";
            for (const [position, name] of Object.entries(positions)) {
                email += `${position}: ${name}\n`;
            }
            email += '\n';

            // Additional Information
            if (sectorDesignator) email += `Sector Designator: ${sectorDesignator}\n`;
            if (ifrTarget) email += `IFR Target: ${ifrTarget}\n`;
            if (upgradePrices) email += `Upgrade Prices: ${upgradePrices}\n`;
            if (legroom) email += `Legroom: ${legroom}\n`;
            if (bulkhead) email += `Bulkhead: ${bulkhead}\n`;
            if (yj) email += `Y/J: ${yj}\n`;
            if (jf) email += `J/F: ${jf}\n`;

            document.getElementById('emailOutput').innerHTML = email.replace(/\n/g, '<br>');
        }

        function copyEmail() {
            const emailOutput = document.getElementById('emailOutput');
            const emailText = emailOutput.innerHTML.replace(/<br>/g, '\n');
            
            const textarea = document.createElement('textarea');
            textarea.value = emailText;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            alert('Email copied to clipboard!');
        }
    </script>
</body>
</html>
